{"remainingRequest":"/Users/mac/Desktop/permissions-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mac/Desktop/permissions-web/src/views/pact/merchantsEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mac/Desktop/permissions-web/src/views/pact/merchantsEdit.vue","mtime":1648622063224},{"path":"/Users/mac/Desktop/permissions-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Desktop/permissions-web/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/mac/Desktop/permissions-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mac/Desktop/permissions-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nvar THIS;\r\nimport botHeader from '@/views/components/bot-header/bot-header';\r\nimport submitBtn from '@/views/components/form-submit/submit-btn';\r\nimport CMapReaderFactory from 'vue-pdf-signature/src/CMapReaderFactory.js';\r\nimport pdf from 'vue-pdf-signature'; \r\nexport default {\r\n    components:{\r\n        botHeader,\r\n        submitBtn,\r\n        pdf\r\n    },\r\n    name: '',\r\n    data(){\r\n        return {\r\n            id:'',\r\n            isBack:true,\r\n            link:'/home/pact/pactOne/merchantsList',\r\n            msg:{},\r\n            ruleForm:{\r\n                name:'',\r\n                phone:'',\r\n                short:'',\r\n                pid:'',\r\n                contract_url:'',\r\n            },\r\n            rules:{\r\n                name:[{ required: true, message: '请输入商户名称', trigger: [] }],\r\n                phone:[{ required: true, message: '请输入联系电话', trigger: [] }],\r\n                short:[{ required: true, message: '请输入商户字母大写', trigger: [] }],\r\n                pid:[{ required: true, message: '请选择服务商', trigger: [] }],\r\n                contract_url:[{ required: true, message: '请上传合同', trigger: [] }],\r\n            },\r\n            pidArr:[],\r\n            //上传合同模板\r\n            ht_path:'',\r\n            img_value:[],\r\n            up_imgurl:'',\r\n            dialogVisible: false,\r\n            pdfPage : 1,\r\n            pageCount: 0,\r\n            token:window.localStorage.flexible_manage_token,\r\n        }\r\n    },\r\n    methods:{\r\n\r\n            submitForm(formName) {\r\n                    THIS.$refs[formName].validate((valid) => {\r\n                        console.log('valid',valid)\r\n                        if (valid) {\r\n                            THIS.submit_from();\r\n                        } else {\r\n                            THIS.$message({\r\n                                    type: 'warning',\r\n                                    message: '请将必填项完善后再提交',\r\n                                    dangerouslyUseHTMLString:true\r\n                                });\r\n                            return false;\r\n                        }\r\n                    });\r\n            },\r\n\r\n            resetForm(formName) {\r\n                THIS.$refs[formName].resetFields();\r\n                THIS.img_value = [];\r\n            },\r\n          \r\n            submit_from(){\r\n                    var data = {\r\n                        name:THIS.ruleForm.name,\r\n                        pid:THIS.ruleForm.pid,\r\n                        short:THIS.ruleForm.short,\r\n                        contract_url:THIS.ruleForm.contract_url,\r\n                        mobile:THIS.ruleForm.phone\r\n                    };\r\n                    var url = '';\r\n                    if(THIS.id){\r\n                        data.id = THIS.id;\r\n                        url = '/merchant/edit'\r\n                    }else{\r\n                        url = '/merchant/add';\r\n                    };\r\n                    vue_Post(THIS,url,data,callback,1,1,1,1);\r\n                    function callback(msg){\r\n                        THIS.$message({\r\n                            type: 'success',\r\n                            message: THIS.id?'编辑成功':'创建成功',\r\n                            dangerouslyUseHTMLString:true\r\n                        });\r\n                        THIS.isBack = false;\r\n                        THIS.$router.replace(THIS.link);\r\n                    }; \r\n            },\r\n\r\n            get_detail(){\r\n                var data = {\r\n                    id:THIS.id\r\n                };\r\n                vue_Post(THIS,'/merchant/get',data,callback,1,1,1,0);\r\n                function callback(msg){\r\n                    msg = msg.info;\r\n                    THIS.ruleForm = {\r\n                        name:msg.name,\r\n                        pid:msg.pid,\r\n                        short:msg.short,\r\n                        contract_url:msg.contract_url,\r\n                        phone:msg.mobile\r\n                    };\r\n                    if(msg.contract_url){\r\n                        THIS.img_value = [{url:msg.contract_url,name:'已上的合同'}];\r\n                        THIS.ht_path = msg.contract_url;\r\n                    };\r\n                }\r\n            },\r\n\r\n            //上传合同\r\n            upload(event, file, fileList){\r\n                if(event.code==200){\r\n                    THIS.ht_path = event.data.path[0];\r\n                    THIS.ht_path = THIS.ht_path.replace('http:','https:');\r\n                    THIS.ruleForm.contract_url = THIS.ht_path;\r\n                }else{\r\n                    THIS.$message({\r\n                        type: 'error',\r\n                        message: event.msg,\r\n                        dangerouslyUseHTMLString:true\r\n                    });\r\n                }\r\n            },\r\n\r\n            deleteImg(file, fileList){\r\n                THIS.ht_path = '';\r\n                THIS.img_value = [];\r\n                THIS.ruleForm.contract_url = '';\r\n            },\r\n\r\n            handlePictureCardPreview(file) {\r\n                THIS.dialogImageUrl = file.url;\r\n                THIS.dialogVisible = true;\r\n            },\r\n\r\n            //获取服务商\r\n            search_pid(msg){\r\n                var data = {\r\n                    name:msg,\r\n                    size:300\r\n                };\r\n                vue_Post(THIS,'/platform/list',data,callback,1,0,0,0);\r\n                function callback(msg){\r\n                    THIS.pidArr = msg.list.map(item=>{\r\n                        return { title:item.name,id:item.id }\r\n                    });\r\n                }\r\n            },\r\n\r\n            //PDF改变页数\r\n            previousPage(){\r\n                var p = THIS.pdfPage;\r\n                p = p>1 ? p-1:THIS.pageCount;\r\n                THIS.pdfPage = p;\r\n            },\r\n\r\n            nextPage(){\r\n                var p = THIS.pdfPage;\r\n                p = p < THIS.pageCount?p+1:1;\r\n                THIS.pdfPage = p;\r\n            },\r\n\r\n    },\r\n    mounted(){\r\n        THIS = this;\r\n        THIS.store.commit('setPageText','合同管理 / 创建商户&服务商合同');\r\n        THIS.up_imgurl = window.localStorage.host+'/common/upload';\r\n        THIS.id = THIS.$route.params.id?THIS.$route.params.id:'';\r\n        THIS.search_pid('');\r\n        if(THIS.id){\r\n            THIS.get_detail();\r\n        };\r\n    },\r\n    beforeDestroy(){\r\n        THIS.store.commit('setPageText','当前位置：合同管理 / 商户&服务商合同');\r\n    },\r\n    beforeRouteLeave(to, from, next){//删除：清除缓存页面缓存  返回：缓存上一页面\r\n        if(!THIS.isBack){\r\n            to.meta.keepAlive = false; \r\n        };\r\n        next();\r\n    },\r\n}\r\n",{"version":3,"sources":["merchantsEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"merchantsEdit.vue","sourceRoot":"src/views/pact","sourcesContent":["<template>\r\n\r\n          <div class=\"views h_bottom po_r pad_l_50 pad_r_50 b_s mr_color01\">\r\n                <bot-header :link='link'></bot-header>\r\n                <el-form :model=\"ruleForm\" label-position='top' :rules=\"rules\" ref=\"ruleForm\" class=\"views_100ch_2 demo-ruleForm\">\r\n                    <div class=\"views_100ch_2\">\r\n                        <div class=\"from_box\">\r\n                            <div class=\"from_tltle\">基本信息</div>\r\n                            <div class=\"w_40 b_s pad_l_30 pad_r_30\" style=\"margin:30px auto;\">\r\n                                <div class=\"w_100\">\r\n                                    <div class=\"w_100 flex col j_between\">\r\n                                        <el-form-item class=\"w_100\" label=\"商户名称\" prop=\"name\">\r\n                                            <el-input v-model=\"ruleForm.name\" placeholder=\"请输入商户名称\"></el-input>\r\n                                        </el-form-item>\r\n                                        <el-form-item class=\"w_100\" label=\"联系电话\" prop=\"phone\">\r\n                                            <el-input v-model=\"ruleForm.phone\" placeholder=\"请输入联系电话\"></el-input>\r\n                                        </el-form-item>\r\n                                        <el-form-item class=\"w_100\" label=\"商户字母大写\" prop=\"short\">\r\n                                            <el-input v-model=\"ruleForm.short\" placeholder=\"请输入商户字母大写\"></el-input>\r\n                                        </el-form-item>\r\n                                        <el-form-item class=\"w_100\" label=\"服务商名称\" prop=\"pid\">\r\n                                            <el-select class=\"w_100 d_b_line\" v-model=\"ruleForm.pid\" remote :remote-method='search_pid' clearable filterable  placeholder=\"请选择服务商名称\">\r\n                                                <el-option v-for=\"(item,index) in pidArr\" :key=\"index\" :label=\"item.title\" :value=\"item.id\"></el-option>\r\n                                            </el-select>\r\n                                        </el-form-item>\r\n                                        <el-form-item class=\"w_100\" label=\"上传协议\" prop=\"contract_url\">\r\n                                            <el-upload\r\n                                                class=\"upload-demo\"\r\n                                                drag\r\n                                                :action=\"up_imgurl\"\r\n                                                :limit=1\r\n                                                :headers = {token:token}\r\n                                                list-type=\"text\"\r\n                                                :on-preview=\"handlePictureCardPreview\"\r\n                                                :on-success='upload'\r\n                                                :on-remove='deleteImg'\r\n                                                :file-list=\"img_value\">\r\n                                                <i class=\"el-icon-upload\"></i>\r\n                                                <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n                                            </el-upload>\r\n                                            <el-dialog title='模板文件预览' :visible.sync=\"dialogVisible\" >\r\n                                                <pdf v-if='ht_path' class='w_100 d_block' :src=\"ht_path\" :page=\"pdfPage\" @num-pages=\"pageCount = $event\" @page-loaded=\"pdfPage = $event\"></pdf>\r\n                                                <div style=\"margin-top: 15px; text-align: right\">\r\n                                                    <el-button type=\"primary\" size=\"small\" @click.stop=\"previousPage\">上一页</el-button>\r\n                                                    <el-button class='mar_r_10' type=\"primary\" size=\"small\" @click.stop=\"nextPage\">下一页</el-button>\r\n                                                    <span class='mar_l_10'>当前第{{pdfPage}}页 / 共{{pageCount}}页</span>\r\n                                                </div>\r\n                                            </el-dialog>\r\n                                        </el-form-item>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </el-form>\r\n                <div class=\"po_b po_bottom bg_fff h_60px w_100\">\r\n                    <submit-btn @submitForm='submitForm' @resetForm='resetForm'></submit-btn>\r\n                </div>\r\n          </div>\r\n  \r\n</template>\r\n\r\n<script>\r\nvar THIS;\r\nimport botHeader from '@/views/components/bot-header/bot-header';\r\nimport submitBtn from '@/views/components/form-submit/submit-btn';\r\nimport CMapReaderFactory from 'vue-pdf-signature/src/CMapReaderFactory.js';\r\nimport pdf from 'vue-pdf-signature'; \r\nexport default {\r\n    components:{\r\n        botHeader,\r\n        submitBtn,\r\n        pdf\r\n    },\r\n    name: '',\r\n    data(){\r\n        return {\r\n            id:'',\r\n            isBack:true,\r\n            link:'/home/pact/pactOne/merchantsList',\r\n            msg:{},\r\n            ruleForm:{\r\n                name:'',\r\n                phone:'',\r\n                short:'',\r\n                pid:'',\r\n                contract_url:'',\r\n            },\r\n            rules:{\r\n                name:[{ required: true, message: '请输入商户名称', trigger: [] }],\r\n                phone:[{ required: true, message: '请输入联系电话', trigger: [] }],\r\n                short:[{ required: true, message: '请输入商户字母大写', trigger: [] }],\r\n                pid:[{ required: true, message: '请选择服务商', trigger: [] }],\r\n                contract_url:[{ required: true, message: '请上传合同', trigger: [] }],\r\n            },\r\n            pidArr:[],\r\n            //上传合同模板\r\n            ht_path:'',\r\n            img_value:[],\r\n            up_imgurl:'',\r\n            dialogVisible: false,\r\n            pdfPage : 1,\r\n            pageCount: 0,\r\n            token:window.localStorage.flexible_manage_token,\r\n        }\r\n    },\r\n    methods:{\r\n\r\n            submitForm(formName) {\r\n                    THIS.$refs[formName].validate((valid) => {\r\n                        console.log('valid',valid)\r\n                        if (valid) {\r\n                            THIS.submit_from();\r\n                        } else {\r\n                            THIS.$message({\r\n                                    type: 'warning',\r\n                                    message: '请将必填项完善后再提交',\r\n                                    dangerouslyUseHTMLString:true\r\n                                });\r\n                            return false;\r\n                        }\r\n                    });\r\n            },\r\n\r\n            resetForm(formName) {\r\n                THIS.$refs[formName].resetFields();\r\n                THIS.img_value = [];\r\n            },\r\n          \r\n            submit_from(){\r\n                    var data = {\r\n                        name:THIS.ruleForm.name,\r\n                        pid:THIS.ruleForm.pid,\r\n                        short:THIS.ruleForm.short,\r\n                        contract_url:THIS.ruleForm.contract_url,\r\n                        mobile:THIS.ruleForm.phone\r\n                    };\r\n                    var url = '';\r\n                    if(THIS.id){\r\n                        data.id = THIS.id;\r\n                        url = '/merchant/edit'\r\n                    }else{\r\n                        url = '/merchant/add';\r\n                    };\r\n                    vue_Post(THIS,url,data,callback,1,1,1,1);\r\n                    function callback(msg){\r\n                        THIS.$message({\r\n                            type: 'success',\r\n                            message: THIS.id?'编辑成功':'创建成功',\r\n                            dangerouslyUseHTMLString:true\r\n                        });\r\n                        THIS.isBack = false;\r\n                        THIS.$router.replace(THIS.link);\r\n                    }; \r\n            },\r\n\r\n            get_detail(){\r\n                var data = {\r\n                    id:THIS.id\r\n                };\r\n                vue_Post(THIS,'/merchant/get',data,callback,1,1,1,0);\r\n                function callback(msg){\r\n                    msg = msg.info;\r\n                    THIS.ruleForm = {\r\n                        name:msg.name,\r\n                        pid:msg.pid,\r\n                        short:msg.short,\r\n                        contract_url:msg.contract_url,\r\n                        phone:msg.mobile\r\n                    };\r\n                    if(msg.contract_url){\r\n                        THIS.img_value = [{url:msg.contract_url,name:'已上的合同'}];\r\n                        THIS.ht_path = msg.contract_url;\r\n                    };\r\n                }\r\n            },\r\n\r\n            //上传合同\r\n            upload(event, file, fileList){\r\n                if(event.code==200){\r\n                    THIS.ht_path = event.data.path[0];\r\n                    THIS.ht_path = THIS.ht_path.replace('http:','https:');\r\n                    THIS.ruleForm.contract_url = THIS.ht_path;\r\n                }else{\r\n                    THIS.$message({\r\n                        type: 'error',\r\n                        message: event.msg,\r\n                        dangerouslyUseHTMLString:true\r\n                    });\r\n                }\r\n            },\r\n\r\n            deleteImg(file, fileList){\r\n                THIS.ht_path = '';\r\n                THIS.img_value = [];\r\n                THIS.ruleForm.contract_url = '';\r\n            },\r\n\r\n            handlePictureCardPreview(file) {\r\n                THIS.dialogImageUrl = file.url;\r\n                THIS.dialogVisible = true;\r\n            },\r\n\r\n            //获取服务商\r\n            search_pid(msg){\r\n                var data = {\r\n                    name:msg,\r\n                    size:300\r\n                };\r\n                vue_Post(THIS,'/platform/list',data,callback,1,0,0,0);\r\n                function callback(msg){\r\n                    THIS.pidArr = msg.list.map(item=>{\r\n                        return { title:item.name,id:item.id }\r\n                    });\r\n                }\r\n            },\r\n\r\n            //PDF改变页数\r\n            previousPage(){\r\n                var p = THIS.pdfPage;\r\n                p = p>1 ? p-1:THIS.pageCount;\r\n                THIS.pdfPage = p;\r\n            },\r\n\r\n            nextPage(){\r\n                var p = THIS.pdfPage;\r\n                p = p < THIS.pageCount?p+1:1;\r\n                THIS.pdfPage = p;\r\n            },\r\n\r\n    },\r\n    mounted(){\r\n        THIS = this;\r\n        THIS.store.commit('setPageText','合同管理 / 创建商户&服务商合同');\r\n        THIS.up_imgurl = window.localStorage.host+'/common/upload';\r\n        THIS.id = THIS.$route.params.id?THIS.$route.params.id:'';\r\n        THIS.search_pid('');\r\n        if(THIS.id){\r\n            THIS.get_detail();\r\n        };\r\n    },\r\n    beforeDestroy(){\r\n        THIS.store.commit('setPageText','当前位置：合同管理 / 商户&服务商合同');\r\n    },\r\n    beforeRouteLeave(to, from, next){//删除：清除缓存页面缓存  返回：缓存上一页面\r\n        if(!THIS.isBack){\r\n            to.meta.keepAlive = false; \r\n        };\r\n        next();\r\n    },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"]}]}